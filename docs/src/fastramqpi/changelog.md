<!--
SPDX-FileCopyrightText: 2021 Magenta ApS <https://magenta.dk>
SPDX-License-Identifier: MPL-2.0
-->

CHANGELOG
=========

## 6.0.0 (2024-03-25)

### Features

- :warning: [#60206] monorepo ð���

> BREAKING CHANGE:
> 
> ra-utils, ra-clients, and ramqp are now part of this package. Make sure you do
> not install them separately.

  
## 5.7.0 (2024-03-22)

### Features

- [#60206] add ra_utils ð��§
 
### Chores

- [#60206] python 3.11 ð���
- [#60206] fixup ð��·
- [#60206] fix imports ð���
  
## 5.6.0 (2024-03-21)

### Features

- [#60206] add ramqp ð��¨
 
### Test improvements

- [#60206] chill coverage requirement ð�« 
- [#60206] integrationtest -> integration_test ð�§�
 
### Chores

- [#60206] fix typing ð�¥±
- [#60206] fix imports ð��¥
  
## 5.5.0 (2024-03-20)

### Features

- [#60206] add raclients ð���
 
### Test improvements

- [#60206] chill coverage requirement ð�¤·
- [#60206] move fastramqpi tests to submodule ð��¦
 
### Chores

- [#60206] add poetry.lock ð���

> Done last to make rebasing easier.

- [#60206] add type hints ð�¤�
- [#60206] use mypy from poetry ð���
- [#60206] fix imports ð�©¹
  
## 5.4.0 (2024-03-20)

### Features

- [#59372] add caching to from_user_context

> This commit adds caching to the `from_user_context` dependency injection
> helper, the motivation behind this change is easing testing when using
> Annotated types, depending on `from_user_context` functions.
> 
> For example, imagine we have a dependency alike this:
> ```python
> Settings = Annotated[_Settings, Depends(from_user_context("settings"))]
> ```
> 
> Now imagine that we wish to replace the Settings model with an `AsyncMock`
> in our test-suite, to do this we will use `app.dependency_overrides`:
> ```python
>     mock = AsyncMock()
>     def mocker():
>       return mock
>     app.dependency_overrides[from_user_context("settings")] = mocker
> ```
> However this example depends on multiple calls to `from_user_context`
> returning the **exact same** inner-function every time, as otherwise the
> dependency override will not hit.
> 
> Caching the `from_user_context` function ensures that we always get the
> **exact same** inner-function as a result.

  
## 5.3.1 (2024-03-19)

### Bug Fixes

- [#60205] update httpx and respx
 
### Documentation

- [#59057] how to debug integration tests containers
  
## 5.3.0 (2024-03-01)

### Features

- **dev**: [#59852] add debugging support via DAP
 
### Documentation

- [#59057] add asyncio_mode = auto to README
  
## 5.2.0 (2024-02-12)

### Features

- **metrics**: [#59699] expose the metrics instrumentator

> This commit exposes the metrics instrumentator in the context, such that
> integrations can register their own scoped metrics, get callbacks to
> update metrics, etc.

  
## 5.1.0 (2024-02-07)

### Features

- [#59328] move testing dependencies to dev dependencies
  
## 5.0.0 (2024-02-06)

### Features

- :warning: [#58056] use correct `queue_prefix`

> BREAKING CHANGE:
> 
> Previously, the `queue_prefix` setting was ignored and overwritten with
> the `application_name`. This is no longer the case.

  
## 4.0.0 (2024-02-02)

### Features

- :warning: [#59332] require graphql version

> BREAKING CHANGE:
> 
> Before, the GraphQL version defaulted to v3 and was set through an
> environment variable. This doesn't make sense, as the application can
> only be run using the version it was written against. Now, we explicitly
> require a GraphQL version to be set in the code, at the same place where
> the auto-generated client is passed.

  
## 3.0.1 (2024-01-05)

### Bug Fixes

- [#58342] pypi-cc
  
## 3.0.0 (2024-01-05)

### Features

- :warning: [#58342] remove implicit settings

> BREAKING CHANGE:
> 
> Previously, users could choose not to pass a `Settings` object to
> `FastRAMQPI`, solely configuring their application implicitly through
> environment variables. This was never documented, as the best practice
> is to specify the program's entire configuration in a single `Settings`,
> with a `FastRAMQPISettings` object as a child.
> 
> The option for implicit settings has been removed, forcing users to
> follow the documented best practice.

- [#58342] integration testing
- [#58342] set base url on mo_client

> Should've been set from the start.

 
### Test improvements

- [#58342] test integration testing
- [#58342] remove autouse environment override
 
### Chores

- [#58342] bump ramqp
  
## 2.0.0 (2023-10-25)

### Features

- :warning: [#57974] cleanup context

> BREAKING CHANGE:
> 
> Previously, both the legacy and new autogenerated GraphQL client were
> exposed under the `graphql_client` context key. This caused bugs that
> were hard to debug and general confusion. Now, users have to explicitly
> request the legacy clients if accessing the context directly. The
> `LegacyGraphQLClient`, `LegacyGraphQLSession`, `LegacyModelClient`
> dependencies work as before.

  
## 1.7.0 (2023-10-06)

### Features

- [#57981] add metric for last successful run
 
### Documentation

- update example section
  
## 1.6.1 (2023-10-03)

### Bug Fixes

- [#56655] Make version bump
  
## 1.6.0 (2023-09-21)

### Features

- [#56655] remove graphql and model client healthchecks

> These clients have been deprecated in favour of codegen. The GraphQL codegen
> client does not allow us to send arbitrary queries, and as such, implementing
> the healthcheck would require each user to define their own healthcheck in the
> queries for the generated client.

  
## 1.5.5 (2023-08-25)

### Bug Fixes

- [#57083] Starlette Lifespan Context

> https://github.com/encode/starlette/pull/2065

  
## 1.5.4 (2023-08-08)

### Bug Fixes

- fixed contact email address

> To avoid a pydantic validation error similar to:
> 
> ```
> pydantic.error_wrappers.ValidationError: 1 validation error for OpenAPI
> info -> contact -> email
> ```

 
### Documentation

- update readme
  
## 1.5.3 (2023-07-27)

### Build improvements

- **deps**: [security] bump requests from 2.28.2 to 2.31.0
  
## 1.5.2 (2023-07-27)

### Build improvements

- **deps**: [security] bump pymdown-extensions from 9.11 to 10.0
  
## 1.5.1 (2023-07-26)

### Bug Fixes

- [#54824] use liveness instead of readiness

> We would like the container to be killed and restarted, instead of simply having its endpoints
> removed from the Service.
> 
> https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#container-probes

  
## 1.5.0 (2023-07-26)

### Features

- [#53863] GraphQL codegen
  
## 1.4.3 (2023-06-02)

### Build improvements

- **deps**: [#51925] update ramqp dependency
  
## 1.4.2 (2023-05-22)

### Build improvements

- **deps**: bump ramqp from 8.3.0 to 8.3.1

> Bumps [ramqp](https://magenta.dk/) from 8.3.0 to 8.3.1.

  
## 1.4.1 (2023-05-12)

### Build improvements

- **deps**: [#53725] update dependencies
  
## 1.4.0 (2023-04-20)

### Features

- [#55697] bump ramqp version to use new amqp system
 
### Chores

- [#53506] enable automerge
  
## 1.3.22 (2023-04-15)

### Chores

- **deps**: bump raclients from 3.1.0 to 3.1.3

> Bumps [raclients](https://magenta.dk/) from 3.1.0 to 3.1.3.

  
## 1.3.21 (2023-04-15)

### Chores

- **deps**: bump fastapi from 0.95.0 to 0.95.1

> Bumps [fastapi](https://github.com/tiangolo/fastapi) from 0.95.0 to 0.95.1.
> - [Release notes](https://github.com/tiangolo/fastapi/releases)
> - [Commits](https://github.com/tiangolo/fastapi/compare/0.95.0...0.95.1)

  
## 1.3.20 (2023-04-15)

### Chores

- **deps**: bump raclients from 3.0.5 to 3.1.0

> Bumps [raclients](https://magenta.dk/) from 3.0.5 to 3.1.0.

  
## 1.3.19 (2023-03-24)

### Chores

- **deps**: bump prometheus-fastapi-instrumentator from 5.10.0 to 6.0.0

> Bumps [prometheus-fastapi-instrumentator](https://github.com/trallnag/prometheus-fastapi-instrumentator) from 5.10.0 to 6.0.0.
> - [Release notes](https://github.com/trallnag/prometheus-fastapi-instrumentator/releases)
> - [Changelog](https://github.com/trallnag/prometheus-fastapi-instrumentator/blob/master/CHANGELOG.md)
> - [Commits](https://github.com/trallnag/prometheus-fastapi-instrumentator/compare/v5.10.0...v6.0.0)

  
## 1.3.18 (2023-03-24)

### Chores

- **deps**: bump pydantic from 1.10.5 to 1.10.7

> Bumps [pydantic](https://github.com/pydantic/pydantic) from 1.10.5 to 1.10.7.
> - [Release notes](https://github.com/pydantic/pydantic/releases)
> - [Changelog](https://github.com/pydantic/pydantic/blob/v1.10.7/HISTORY.md)
> - [Commits](https://github.com/pydantic/pydantic/compare/v1.10.5...v1.10.7)

  
## 1.3.17 (2023-03-24)

### Chores

- **deps**: bump ra-utils from 1.12.6 to 1.12.10

> Bumps [ra-utils](https://magenta.dk/) from 1.12.6 to 1.12.10.

  
## 1.3.16 (2023-03-22)

### Chores

- **deps**: bump ra-utils from 1.12.2 to 1.12.6

> Bumps [ra-utils](https://magenta.dk/) from 1.12.2 to 1.12.6.

  
## 1.3.15 (2023-03-20)

### Chores

- **deps**: bump ramqp from 6.9.1 to 6.9.5

> Bumps [ramqp](https://magenta.dk/) from 6.9.1 to 6.9.5.

  
## 1.3.14 (2023-03-20)

### Chores

- **deps**: bump fastapi from 0.93.0 to 0.95.0

> Bumps [fastapi](https://github.com/tiangolo/fastapi) from 0.93.0 to 0.95.0.
> - [Release notes](https://github.com/tiangolo/fastapi/releases)
> - [Commits](https://github.com/tiangolo/fastapi/compare/0.93.0...0.95.0)

- [#53725] Use new FastAPI lifespan syntax

> See https://fastapi.tiangolo.com/release-notes/#0930.

- [#53725] Use new FastAPI lifespan syntax

> See https://fastapi.tiangolo.com/release-notes/#0930.

  
## 1.3.13 (2023-03-13)

### Chores

- **deps**: bump pydantic from 1.10.5 to 1.10.6

> Bumps [pydantic](https://github.com/pydantic/pydantic) from 1.10.5 to 1.10.6.
> - [Release notes](https://github.com/pydantic/pydantic/releases)
> - [Changelog](https://github.com/pydantic/pydantic/blob/v1.10.6/HISTORY.md)
> - [Commits](https://github.com/pydantic/pydantic/compare/v1.10.5...v1.10.6)

  
## 1.3.12 (2023-03-09)

### Bug Fixes

- [#55008] missing get call to async_httpx_client
  
## 1.3.11 (2023-03-09)

### Bug Fixes

- [#55008] fix non-working GraphQL URL
  
## 1.3.10 (2023-03-08)

### Chores

- **deps**: [#53725] Bump dependencies
  
## 1.3.9 (2023-03-08)

### Bug Fixes

- [#55008] Fix healthcheck mocking issue
  
## 1.3.8 (2023-02-27)

### Chores

- **deps**: bump ra-utils from 1.11.15 to 1.11.16

> Bumps [ra-utils](https://magenta.dk/) from 1.11.15 to 1.11.16.

  
## 1.3.7 (2023-02-27)

### Chores

- **deps**: bump prometheus-fastapi-instrumentator from 5.9.1 to 5.10.0

> Bumps [prometheus-fastapi-instrumentator](https://github.com/trallnag/prometheus-fastapi-instrumentator) from 5.9.1 to 5.10.0.
> - [Release notes](https://github.com/trallnag/prometheus-fastapi-instrumentator/releases)
> - [Changelog](https://github.com/trallnag/prometheus-fastapi-instrumentator/blob/master/CHANGELOG.md)
> - [Commits](https://github.com/trallnag/prometheus-fastapi-instrumentator/compare/v5.9.1...v5.10.0)

  
## 1.3.6 (2023-02-26)

### Chores

- **deps**: bump ra-utils from 1.11.12 to 1.11.15

> Bumps [ra-utils](https://magenta.dk/) from 1.11.12 to 1.11.15.

  
## 1.3.5 (2023-02-21)

### Chores

- **deps**: bump ra-utils from 1.11.3 to 1.11.12

> Bumps [ra-utils](https://magenta.dk/) from 1.11.3 to 1.11.12.

  
## 1.3.4 (2023-02-17)

### Chores

- **deps**: bump pydantic from 1.10.4 to 1.10.5

> Bumps [pydantic](https://github.com/pydantic/pydantic) from 1.10.4 to 1.10.5.
> - [Release notes](https://github.com/pydantic/pydantic/releases)
> - [Changelog](https://github.com/pydantic/pydantic/blob/v1.10.5/HISTORY.md)
> - [Commits](https://github.com/pydantic/pydantic/compare/v1.10.4...v1.10.5)

  
## 1.3.3 (2023-02-17)

### Chores

- **deps**: bump ra-utils from 1.9.0 to 1.11.3

> Bumps [ra-utils](https://magenta.dk/) from 1.9.0 to 1.11.3.

  
## 1.3.2 (2023-02-14)

### CI improvements

- [#52164] Delete .releaserc.yaml
 
### Chores

- **deps**: [security] bump cryptography from 39.0.0 to 39.0.1

> Bumps [cryptography](https://github.com/pyca/cryptography) from 39.0.0 to 39.0.1. **This update includes a security fix.**
> - [Release notes](https://github.com/pyca/cryptography/releases)
> - [Changelog](https://github.com/pyca/cryptography/blob/main/CHANGELOG.rst)
> - [Commits](https://github.com/pyca/cryptography/compare/39.0.0...39.0.1)

- **deps**: bump ra-utils from 1.7.1 to 1.9.0

> Bumps [ra-utils](https://magenta.dk/) from 1.7.1 to 1.9.0.

  
## 1.3.1 (2023-01-19)

### Bug Fixes

- bump dependencies

> fix: bump dependencies
> 
> Apply 1 suggestion(s) to 1 file(s)
> 
> Apply 1 suggestion(s) to 1 file(s)
> 
> Apply 1 suggestion(s) to 1 file(s)

- bump dependencies
 
### Chores

- **deps**: [security] bump cryptography from 37.0.2 to 38.0.3

> Bumps [cryptography](https://github.com/pyca/cryptography) from 37.0.2 to 38.0.3. **This update includes a security fix.**
> - [Release notes](https://github.com/pyca/cryptography/releases)
> - [Changelog](https://github.com/pyca/cryptography/blob/main/CHANGELOG.rst)
> - [Commits](https://github.com/pyca/cryptography/compare/37.0.2...38.0.3)

- **deps**: bump fastapi from 0.85.0 to 0.85.2

> Bumps [fastapi](https://github.com/tiangolo/fastapi) from 0.85.0 to 0.85.2.
> - [Release notes](https://github.com/tiangolo/fastapi/releases)
> - [Commits](https://github.com/tiangolo/fastapi/compare/0.85.0...0.85.2)

- **deps**: [security] bump certifi from 2021.10.8 to 2022.12.7

> Bumps [certifi](https://github.com/certifi/python-certifi) from 2021.10.8 to 2022.12.7. **This update includes a security fix.**
> - [Release notes](https://github.com/certifi/python-certifi/releases)
> - [Commits](https://github.com/certifi/python-certifi/compare/2021.10.08...2022.12.07)

- **deps**: bump ra-utils from 1.2.1 to 1.3.1

> Bumps [ra-utils](https://magenta.dk/) from 1.2.1 to 1.3.1.

- **deps**: bump structlog from 22.1.0 to 22.3.0

> Bumps [structlog](https://github.com/hynek/structlog) from 22.1.0 to 22.3.0.
> - [Release notes](https://github.com/hynek/structlog/releases)
> - [Changelog](https://github.com/hynek/structlog/blob/main/CHANGELOG.md)
> - [Commits](https://github.com/hynek/structlog/compare/22.1.0...22.3.0)

- **deps**: bump ramqp from 6.6.2 to 6.7.1

> Bumps [ramqp](https://magenta.dk/) from 6.6.2 to 6.7.1.

- **deps**: bump pydantic from 1.10.2 to 1.10.4

> Bumps [pydantic](https://github.com/pydantic/pydantic) from 1.10.2 to 1.10.4.
> - [Release notes](https://github.com/pydantic/pydantic/releases)
> - [Changelog](https://github.com/pydantic/pydantic/blob/v1.10.4/HISTORY.md)
> - [Commits](https://github.com/pydantic/pydantic/compare/v1.10.2...v1.10.4)

- [#52218] add dependabot
- [#52916] Fix pyproject
  
## 1.3.0 (2022-09-17)

### Features

- [#52316] bumped dependencies
  
## 1.2.0 (2022-09-14)

### Features

- [#52316] split up settings
  
## 1.1.0 (2022-09-14)

### Features

- [#52316] split FastRAMQPI into two
 
### Test improvements

- [#52316] fixup tests
 
### Chores

- [#52316] move main.py to fastapi.py
  
## 1.0.1 (2022-08-16)

### Bug Fixes

- [#48869] cleanup default settings
 
### CI improvements

- [#48869] remove prefix 'v' from release tags

> So far releases have had a version tag alike: v1.0.0, instead of just
> 1.0.0.
> This change ensures that semantic-release tags our releases without the
> prefix 'v', and thus ensures compatability with the rest of our release
> management flow.

  
## v1.0.0 (2022-08-15)

### Features

- [#48869] added FastAPI metadata
- [#48869] Add FastRAMQPI repository
